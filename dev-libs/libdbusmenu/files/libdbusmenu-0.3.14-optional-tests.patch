--- configure.ac.orig	2010-09-20 21:51:50.289828895 +0200
+++ configure.ac	2010-09-20 22:01:21.623107607 +0200
@@ -76,8 +76,15 @@
 JSON_GLIB_REQUIRED_VERSION=0.6.0
 GIO_UNIX_REQUIRED_VERSION=2.24
 
+AC_ARG_ENABLE([tests],
+	AC_HELP_STRING([--disable-tests], [Disable tests]),
+	[enable_tests=$enableval], enable_tests=auto)
+AM_CONDITIONAL([WANT_TESTS], [test "x$enable_tests" != "xno"])
+
+if test "x$enable_tests" != "xno" ; then
 PKG_CHECK_MODULES(DBUSMENUTESTS,  json-glib-1.0 >= $JSON_GLIB_REQUIRED_VERSION
                                   gio-unix-2.0  >= $GIO_UNIX_REQUIRED_VERSION)
+fi
 
 AC_SUBST(DBUSMENUTESTS_CFLAGS)
 AC_SUBST(DBUSMENUTESTS_LIBS)
--- Makefile.am.orig	2010-09-20 21:58:41.616751481 +0200
+++ Makefile.am	2010-09-20 22:01:55.525674385 +0200
@@ -9,6 +9,9 @@
 	tools \
-	tests \
 	docs \
 	po
 
+if WANT_TESTS
+SUBDIRS += tests
+endif
+
 DISTCHECK_CONFIGURE_FLAGS = --enable-introspection --enable-gtk-doc
--- tools/Makefile.am.orig	2010-09-20 22:02:07.280175897 +0200
+++ tools/Makefile.am	2010-09-20 22:02:40.579759752 +0200
@@ -1,3 +1,7 @@
 
-SUBDIRS = testapp
+SUBDIRS =
+
+if WANT_TESTS
+SUBDIRS += testapp
+endif
 
