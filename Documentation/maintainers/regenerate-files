#!/bin/bash

SCRIPT=`basename $0`
if [[ ! -f "${PWD}/${SCRIPT}" ]]; then
	echo "You need to be in '"`dirname $0`"' dir to run this script."
	exit -1
fi

USERNAME=${USER}
[[ -n ${ECHANGELOG_USER} ]] && USERNAME=${ECHANGELOG_USER}

HEADER="\
# ${USERNAME} ("`LC_ALL=C date +"%d %b %Y"`")
# Autogenerated by ${SCRIPT}, DO NOT EDIT."

# regenerate KDE 3.5 keywords
pushd ../package.keywords/ > /dev/null
echo -e "\
${HEADER}
# Combined KDE 3.5 package.keywords file." > kde-3.5.keywords
if [[ -d kde-3.5.d ]]; then
	cat kde-3.5.d/* >> kde-3.5.keywords
fi
popd > /dev/null

# regenerate live unmask entries (base for live package mask)
pushd ../package.unmask/ > /dev/null
echo -e "\
${HEADER}
# Live packages are masked by default.
# Edit Documentation/package.unmask/kde-live.d/ files instead." > kde-live
if [[ -d kde-live.d ]]; then
	cat kde-live.d/* >> kde-live
fi
popd > /dev/null

# regenerate package mask
pushd ../../profiles/ > /dev/null
echo -e "\
${HEADER}
# Edit profiles/package.mask.d/ files instead." > package.mask
if [[ -d package.mask.d ]]; then
	for x in package.mask.d/*; do
		echo >> package.mask
		cat ${x} >> package.mask
	done
fi
popd > /dev/null
